{% extends 'base.html' %}

{% block content %}
<div class="row">
  <div class="col-12">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h1 class="h3 mb-0">{{ ticket_label }} Tickets</h1>
      <a class="btn btn-primary" href="{{ url_for('create_ticket', ticket_type=ticket_type) }}">Create {{ ticket_label }} Ticket</a>
    </div>
    {% if tickets %}
    <div class="table-responsive">
      <table class="table table-striped align-middle">
        <thead class="table-dark">
          <tr>
            <th scope="col">ID</th>
            <th scope="col">Plate</th>
            <th scope="col">Zone</th>
            <th scope="col">Camera</th>
            <th scope="col">Spot</th>
            <th scope="col">Entry</th>
            <th scope="col">Exit</th>
            <th scope="col">Crop</th>
            <th scope="col">Status</th>
            <th scope="col">Entry Time</th>
            <th scope="col">Exit Time</th>
            <th scope="col">Created</th>
            <th scope="col" class="text-end">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for ticket in tickets %}
          <tr>
            <td>{{ ticket.id }}</td>
            <td>{{ ticket.plate_code }} {{ ticket.plate_number }}</td>
            <td>{{ ticket.zone_region }} {{ ticket.zone_name }}</td>
            <td>{{ ticket.camera_ip or '-' }}</td>
            <td>{{ ticket.spot_number or '-' }}</td>
            <td>
              {% if image_url(ticket.entry_image_path) %}
              <img
                src="{{ image_url(ticket.entry_image_path) }}"
                data-fullsrc="{{ image_url(ticket.entry_image_path) }}"
                alt="Entry image for ticket {{ ticket.id }}"
                class="ticket-thumb"
              />
              {% else %}
              <span class="text-muted">No image</span>
              {% endif %}
            </td>
            <td>
              {% if image_url(ticket.exit_image_path) %}
              <img
                src="{{ image_url(ticket.exit_image_path) }}"
                data-fullsrc="{{ image_url(ticket.exit_image_path) }}"
                alt="Exit image for ticket {{ ticket.id }}"
                class="ticket-thumb"
              />
              {% else %}
              <span class="text-muted">No image</span>
              {% endif %}
            </td>
            <td>
              {% if image_url(ticket.crop_image_path) %}
              <img
                src="{{ image_url(ticket.crop_image_path) }}"
                data-fullsrc="{{ image_url(ticket.crop_image_path) }}"
                alt="Crop image for ticket {{ ticket.id }}"
                class="ticket-thumb"
              />
              {% else %}
              <span class="text-muted">No image</span>
              {% endif %}
            </td>
            <td><span class="badge bg-secondary text-uppercase">{{ ticket.status or 'n/a' }}</span></td>
            <td>{{ ticket.entry_time or '—' }}</td>
            <td>{{ ticket.exit_time or '—' }}</td>
            <td>{{ ticket.created_at or '—' }}</td>
            <td class="text-end">
              <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('edit_ticket', ticket_type=ticket_type, ticket_id=ticket.id) }}">Edit</a>
              <form class="d-inline" method="post" action="{{ url_for('delete_ticket', ticket_type=ticket_type, ticket_id=ticket.id) }}" onsubmit="return confirm('Delete ticket #{{ ticket.id }}?');">
                <button type="submit" class="btn btn-sm btn-outline-danger">Delete</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div class="alert alert-info">No {{ ticket_label }} tickets yet. Create one to get started.</div>
    {% endif %}
  </div>
</div>
{% endblock %}
